# TODO

- [ ] Language features
  - [ ] write a preprocessor
  - [ ] make field and compound inits the same, since thats how it should be
  - [ ] size_t
  - [ ] IRIS only
    - [ ] floats
  - [ ] Variable length arguments
    - [ ] va_list?
  - [ ] defining a lot of std functions
    - [ ] Along with this, only include functions that are *USED* (ALL functions, not just std)
    - [ ] stdlib
      - [ ] malloc
      - [ ] free
      - [ ] calloc
      - [ ] realloc
      - [ ] qsort
      - [ ] rand
      - [ ] rand_r
      - [ ] srand
      - [ ] abort
      - [ ] abs
      - [ ] WHEN IRIS FLOATS
        - [ ] atof
      - [ ] atoi
      - [ ] IF LONGS
        - [ ] atol
        - [ ] labs
        - [ ] ldiv
      - [ ] bsearch
      - [ ] div
      - [ ] exit
    - [ ] string
      - [ ] strcmp
      - [ ] strncmp
      - [ ] strlen
      - [ ] strcpy
      - [ ] strncpy
      - [ ] strcat
      - [ ] strncat
      - [ ] memchr
      - [ ] memcmp
      - [ ] memcpy
      - [ ] memmove
      - [ ] memset
      - [ ] strchr
      - [ ] strcspn
      - [ ] strerror
      - [ ] strpbrk
      - [ ] strrchr
      - [ ] strspn
      - [ ] strstr
      - [ ] strtok
      - [ ] strtok_r
    - [ ] stdio
      - [ ] getchar
      - [ ] gets
      - [ ] perror
      - [ ] printf
      - [ ] putchar
      - [ ] puts
      - [ ] scanf
      - [ ] sprintf
      - [ ] snprintf
      - [ ] sscanf
      - [ ] ***IF*** va_list is implemented
        - [ ] vprintf
        - [ ] vscanf
        - [ ] vsprintf
        - [ ] vsnprintf
    - [ ] math (ONLY FOR WHEN IRIS FLOATS ARE IMPLEMENTED)
      - [ ] acos
      - [ ] asin
      - [ ] atan
      - [ ] atan2
      - [ ] ceil
      - [ ] cos
      - [ ] cosh
      - [ ] erf
      - [ ] erfc
      - [ ] exp
      - [ ] fabs
      - [ ] floor
      - [ ] fmod
      - [ ] frexp
      - [ ] gamma
      - [ ] hypot
      - [ ] j0
      - [ ] j1
      - [ ] jn
      - [ ] ldexp
      - [ ] log
      - [ ] log10
      - [ ] modf
      - [ ] nextafter
      - [ ] pow
      - [ ] sin
      - [ ] sinh
      - [ ] sqrt
      - [ ] tan
      - [ ] tanh

- [ ] don't use indexmap crate, just make our own

- [x] Make the calling convention better
  - [x] Use registers
  - [ ] Actually implement passing around raw structs/unions

- [ ] Add more per-cpu things
  - [ ] Perhaps a custom ABI per cpu?
  - [ ] Specifiying register info
    - [x] SP
    - [x] BP
    - [ ] Temporary registers (minimum of 3)
    - [ ] everything else
- [ ] optimizations
  - [ ] MIR optimizations
    - [x] Constant folding
    - [x] Unreachable code KILLING!!!
    - [x] Block combining
    - [x] Copy propagation
    - [x] Dead store elimination
      - [ ] maybe add volitile SCS too?
    - [x] inlining
      - [ ] Improve inlining
        - [ ] Global Budget for inlining so we don't have code size explosions
          - [ ] Perhaps allow some recursive inlining when doing this?
        - [ ] Get a heuristic for if further optimizations will be possible or not
          - [ ] Inline very small functions no matter what
        - [ ] Consider liveness impact for register alloc
    - [ ] optimize sets followed by branches
      - like `LTE a 2 -> b; BRH EQ b 0 .1 .2` -> `BRH LTE a 2 .2 .1`
    - [ ] basically implement all of [this stuff](https://www.cs.cornell.edu/courses/cs6120/2020fa/lesson/1/)
    - [ ] Remove unused static functions
  - [ ] Assembly optimizations
    - [ ] Register allocation
      - [x] Basic graph coloring
        - [ ] Perhaps improve the graph coloring algorithm?
      - [ ] Coalescing
      - [ ] Improve spill cost metrics
    - [x] During MIR->ASM, try and find an optimal order for the blocks
      - [ ] maybe make this better
    - [ ] Basically reimplement ModPunchTree's Optimizer V2 (on Vals, not PVals)
  - [ ] Make a generic CFG construct so we don't just basically copy-paste when constructing an asm cfg and mir cfg
